<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Our Products | Shopzilla</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
</head>

<body>
  <!-- âœ… NAVBAR -->
  <header class="navbar">
    <div class="logo">Shopzilla</div>
    <nav>
      <a href="/">Home</a>
      <a href="/products" class="active">Products</a>
      <a href="/about">About</a>
      <a href="/contact">Contact</a>
    </nav>
    <div class="nav-right">
      <a href="/cart" class="cart-btn">ðŸ›’ Cart (<%= cartCount || 0 %>)</a>
      <a href="/login" class="btn-outline">Sign In</a>
      <a href="/register" class="btn-primary">Sign Up</a>
    </div>
  </header>

  <!-- âœ… PAGE HEADER -->
  <section class="page-header">
    <h1>Our Products</h1>
    <p>Explore premium, hand-picked items across all categories â€” from tech to lifestyle.</p>
  </section>

  <!-- âœ… CATEGORY FILTER -->
  <div class="category-bar">
    <% const categories = ['All', 'Electronics', 'Accessories', 'Fitness', 'Lifestyle', 'Food & Beverage']; %>
    <% categories.forEach(cat => { %>
      <a 
        href="/products?category=<%= encodeURIComponent(cat) %>&sort=<%= sortBy %>&order=<%= order %>"
        class="<%= selectedCategory === cat ? 'active' : '' %>">
        <%= cat %>
      </a>
    <% }) %>
  </div>

  <!-- âœ… SORTING -->
  <div class="sort-container">
    <label for="sort">Sort by:</label>
    <select id="sort" onchange="changeSort()">
      <option value="name" <%= sortBy === 'name' ? 'selected' : '' %>>Name (Aâ€“Z)</option>
      <option value="price" <%= sortBy === 'price' ? 'selected' : '' %>>Price (Low â†’ High)</option>
    </select>
  </div>

  <!-- âœ… PRODUCTS GRID -->
  <section class="products-grid">
    <% if (products.length === 0) { %>
      <p style="text-align:center; font-size:1.1rem; color:#777;">No products found in this category.</p>
    <% } else { %>
      <% products.forEach(product => { %>
        <div class="product-card">
          <img src="<%= product.image %>" alt="<%= product.name %>">
          <h3><%= product.name %></h3>
          <p class="price">$<%= product.price.toFixed(2) %></p>
          <p class="desc"><%= product.description %></p>
          <div class="meta">
            <span class="tag"><%= product.category %></span>
            <span class="stock"><%= product.stock ? product.stock + ' in stock' : '' %></span>
          </div>
          <div class="actions">
            <!-- ðŸ›’ AJAX ADD TO CART -->
            <button class="btn-primary" onclick="addToCart('<%= product._id %>')">Add to Cart</button>
            <a href="/product/<%= product._id %>" class="btn-outline">View Details</a>
          </div>
        </div>
      <% }) %>
    <% } %>
  </section>

  <!-- âœ… PAGINATION -->
  <% if (totalPages > 1) { %>
  <div class="pagination">
    <% if (currentPage > 1) { %>
      <a href="/products?page=<%= currentPage - 1 %>&category=<%= selectedCategory %>&sort=<%= sortBy %>&order=<%= order %>" class="page-btn">â€¹ Prev</a>
    <% } %>

    <% for (let i = 1; i <= totalPages; i++) { %>
      <a href="/products?page=<%= i %>&category=<%= selectedCategory %>&sort=<%= sortBy %>&order=<%= order %>"
         class="page-btn <%= currentPage === i ? 'active' : '' %>"><%= i %></a>
    <% } %>

    <% if (currentPage < totalPages) { %>
      <a href="/products?page=<%= currentPage + 1 %>&category=<%= selectedCategory %>&sort=<%= sortBy %>&order=<%= order %>" class="page-btn">Next â€º</a>
    <% } %>
  </div>
  <% } %>

  <!-- âœ… FOOTER -->
  <footer>
    <div>
      <h4>Shopzilla</h4>
      <p>Your trusted online store for premium products and great service.</p>
    </div>
    <div>
      <h4>Quick Links</h4>
      <a href="/">Home</a>
      <a href="/products">Products</a>
      <a href="/about">About</a>
      <a href="/contact">Contact</a>
    </div>
    <p>Â© 2025 Shopzilla. All rights reserved.</p>
  </footer>

  <script>
async function addToCart(event, id) {
  event.preventDefault(); // ðŸš« stop page navigation or form submission
  try {
    const res = await fetch(`/cart/add/${id}`, { method: 'POST' });
    const data = await res.json();

    if (data.success) {
      // âœ… Update cart icon count
      const cartBtn = document.querySelector('.cart-btn');
      cartBtn.textContent = `ðŸ›’ Cart (${data.count})`;

      // Optional: show a temporary success message
      const alertBox = document.createElement('div');
      alertBox.textContent = 'âœ… Added to cart!';
      alertBox.style.position = 'fixed';
      alertBox.style.bottom = '20px';
      alertBox.style.right = '20px';
      alertBox.style.background = '#28a745';
      alertBox.style.color = '#fff';
      alertBox.style.padding = '10px 15px';
      alertBox.style.borderRadius = '6px';
      alertBox.style.fontSize = '0.9rem';
      alertBox.style.boxShadow = '0 2px 5px rgba(0,0,0,0.2)';
      document.body.appendChild(alertBox);
      setTimeout(() => alertBox.remove(), 1500);
    } else {
      alert('Error adding to cart');
    }
  } catch (err) {
    console.error('Error:', err);
    alert('Error adding to cart');
  }
}
</script>

</body>
</html>
